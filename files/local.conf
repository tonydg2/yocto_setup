# Machine Selection
#MACHINE ?= "myhardware-u96v2-zynqmp"
MACHINE ?= "myhardware-zc702-zynq"

# This sets the default machine if no other machine is selected:
#MACHINE ??= "zynqmp-generic"
#MACHINE ??= "zynq-generic"

IMAGE_FSTYPES:append=" wic"

#DISTRO ?= "poky"
DISTRO ?= "petalinux"

PACKAGE_CLASSES ?= "package_rpm"

# adg - this gave root access (su, no password)
#EXTRA_IMAGE_FEATURES ?= "debug-tweaks"

EXTRA_IMAGE_FEATURES ?= " \
  empty-root-password \
  serial-autologin-root \
  "


USER_CLASSES ?= "buildstats"

# Create license (-lic) packages
LICENSE_CREATE_PACKAGE = "1"
COPY_LIC_MANIFEST = "1"

# URI's to check for connectivity from the sanity.bbclass
CONNECTIVITY_CHECK_URIS ?= ""

# Should mirror tarballs be generated during the do_fetch stage?
BB_GENERATE_MIRROR_TARBALLS ?= "1"

PATCHRESOLVE = "noop"

BB_DISKMON_DIRS ??= "\
    STOPTASKS,${TMPDIR},1G,100K \
    STOPTASKS,${DL_DIR},1G,100K \
    STOPTASKS,${SSTATE_DIR},1G,100K \
    STOPTASKS,/tmp,100M,100K \
    HALT,${TMPDIR},100M,1K \
    HALT,${DL_DIR},100M,1K \
    HALT,${SSTATE_DIR},100M,1K \
    HALT,/tmp,10M,1K"


PACKAGECONFIG:append:pn-qemu-system-native = " sdl"
BB_HASHSERVE = ""
BB_SIGNATURE_HANDLER = "OEBasicHash"
PRSERV_HOST = "localhost:0"

LICENSE_FLAGS_ACCEPTED = " \
        commercial_${MLPREFIX}ffmpeg \
        commercial_${MLPREFIX}x264 \
        commercial_${MLPREFIX}gstreamer1.0-omx \
        commercial_${MLPREFIX}libomxil \
        commercial_${MLPREFIX}sox \
        commercial_${MLPREFIX}faac \
        commercial_${MLPREFIX}faad2 \
        xilinx "

CONF_VERSION = "2"

INHERIT += "extrausers"
PASSWD = "\$5\$xJgcbxWNCFPGGiGP\$mO2ziTUzUdnkLoOflOtKt6KOf6aBovJ62k6V0G8tPu5"
EXTRA_USERS_PARAMS = "\
  useradd -p '${PASSWD}' adg; \
  usermod -p '${PASSWD}' root; \
"
#adg21:
#   \$5\$xJgcbxWNCFPGGiGP\$mO2ziTUzUdnkLoOflOtKt6KOf6aBovJ62k6V0G8tPu5

# hoping that this contains the wl180x crap
#BBMASK += "|linux-firmware-ti-bt.bb$"
#BBMASK += "/meta-xilinx/meta-xilinx-core/recipes-kernel/linux-firmware/"
## This shut off the bluetooth/wifi, was targeting the old U96-V1 version TI chip wl183x

## linux-firmware_20230210.bb
#BBMASK += "/poky/meta/recipes-kernel/linux-firmware/"

#wl180x is the old u96V1 wifi/bt chip, is contained within linux-firmware-ti-bt.bb ??
#MACHINE_ESSENTIAL_EXTRA_RDEPENDS:remove = "linux-firmware-wl18xx linux-firmware-ti-bt-wl180x"

#this needed if systemd is removed from DISTRO_FEATURES
#VIRTUAL-RUNTIME_init_manager = ""
#VIRTUAL-RUNTIME_initscripts = ""

#DISTRO_FEATURES:remove = "acl alsa ipv6 usbgadget usbhost wifi bluetooth x11 opengl xen pulseaudio nfs wayland \ 
#                          openamp systemd \
#                          virtualization gobject-introspection-data libmali "

#IMAGE_INSTALL:remove = "nfs-utils nfs-utils-client can-utils bridge-utils tcf-agent iperf3 meson libdfx"
#IMAGE_INSTALL:remove = "hellopm u-boot-tools fpga-manager-script linux-xlnx-udev-rules kernel-modules pciutils mtd-utils nfs-utils nfs-utils-client can-utils bridge-utils tcf-agent iperf3 meson libdfx"



#DISTRO_FEATURES_BACKFILL_CONSIDERED:append = " pulseaudio gobject-introspection-data ldconfig libmali"

#DISTRO_FEATURES:remove = " \
#                          acl \
#                          alsa \
#                          busybox-hd \
#                          busybox-telnetd \
#                          busybox-inetd \
#                          busybox-httpd \
#                          bluetooth \
#                          wifi \
#                          debuginfod \
#                          ipv4 \
#                          ipv6 \
#                          pcmcia \
#                          usbgadget \
#                          usbhost \
#                          xattr \
#                          nfs \
#                          zeroconf \
#                          pci \
#                          3g \
#                          nfc \
#                          x11 \
#                          vfat \
#                          seccomp \
#                          largefile \
#                          pam \
#                          ptest \
#                          fbdev \
#                          opengl \
#                          openamp \
#                          x11 \
#                          multiarch \
#                          security \
#                          tpm \
#                          virtualization \
#                          vmsep \
#                          wayland \
#                          xen \
#                          pulseaudio \
#                          gobject-introspection-data \
#                          ldconfig \
#                          libmali \
#"
#acl                        
#alsa                       
#debuginfod                 
#ext2                       
#ipv4                       
#ipv6                       
#pcmcia                     
#usbgadget                  
#usbhost                    
#xattr                      
#nfs                        
#zeroconf                   
#pci                        
#3g                         
#nfc                        
#x11                        
#vfat                       
#seccomp                    
#busybox-hd                 
#busybox-ftpd               
#busybox-ftp                
#busybox-telnetd            
#busybox-mdev               
#busybox-inetd              
#busybox-httpd              
#largefile                  
#pam                        
#ptest                      
#fbdev                      
#opengl                     
#openamp                    
#x11                        
#multiarch                  
#security                   
#tpm                        
#virtualization             
#vmsep                      
#wayland                    
#xen                        
#systemd                    
#pulseaudio                 
#sysvinit                   
#gobject-introspection-data 
#ldconfig                   
#libmali                    


##DISTRO_FEATURES="acl alsa  debuginfod ext2 ipv4 ipv6 pcmcia usbgadget usbhost  xattr nfs zeroconf pci 3g nfc x11 
#                   vfat seccomp  	busybox-hd 	busybox-ftpd 	busybox-ftp 	busybox-telnetd 	busybox-mdev 	
#                   busybox-inetd 	busybox-httpd 	 largefile pam ptest fbdev opengl openamp x11 multiarch security 
#                   tpm virtualization vmsep wayland xen systemd pulseaudio sysvinit gobject-introspection-data ldconfig 
#                   libmali"

##DISTRO_FEATURES_BACKFILL="pulseaudio sysvinit gobject-introspection-data ldconfig libmali systemd"
##DISTRO_FEATURES_BACKFILL_CONSIDERED=" "
##DISTRO_FEATURES_DEFAULT="acl alsa  debuginfod ext2 ipv4 ipv6 pcmcia usbgadget usbhost  xattr nfs zeroconf pci 3g nfc 
#                           x11 vfat seccomp"
##DISTRO_FEATURES_DEFAULT:microblaze="ipv4 ipv6 xattr"
##DISTRO_FEATURES_FILTER_NATIVE="api-documentation debuginfod opengl wayland"
##DISTRO_FEATURES_FILTER_NATIVESDK="api-documentation debuginfod opengl wayland"
##DISTRO_FEATURES_NATIVE="x11 ipv6 xattr"
##DISTRO_FEATURES_NATIVESDK="x11"